---
framework: next-app-router
widgetPackage: "@ncodes/widget"
capabilityMapPath: "{{capabilityMapPath}}"
generatedBy: "n.codes CLI v{{version}}"
generatedAt: "{{timestamp}}"
---

# n.codes Installation for Next.js (App Router)

## Prerequisites
- `{{capabilityMapPath}}` exists in project root (generated by `n.codes sync`)
- Project uses Next.js with App Router (`app/` directory)

## Step 1: Install the widget package

**Action:** Install the n.codes widget SDK.

```bash
npm install @ncodes/widget
```

**Verify:** `node_modules/@ncodes/widget` directory exists.

## Step 2: Copy capability map to public/

**Action:** Copy the JSON capability map to the public directory so it's accessible at runtime.

```bash
cp {{capabilityMapPath}} public/n.codes.capabilities.json
```

**Verify:** `public/n.codes.capabilities.json` exists and is valid JSON.

## Step 3: Create the n.codes widget component

**File:** `app/components/NCodesWidget.tsx` (create new file)
**Action:** Create a client component that initializes the widget.

```tsx
'use client';

import { useEffect } from 'react';

export default function NCodesWidget({ user }: { user: { id: string; name: string } | null }) {
  useEffect(() => {
    if (!user) return;

    let NCodes: any;
    import('@ncodes/widget').then((mod) => {
      NCodes = mod;
      NCodes.init({
        user,
        capabilityMapUrl: '/n.codes.capabilities.json',
        mode: 'simulation',
        theme: 'auto',
      });
    });

    return () => {
      if (NCodes) NCodes.destroy();
    };
  }, [user]);

  return null;
}
```

**Verify:** File exists at `app/components/NCodesWidget.tsx`.

## Step 4: Add widget to root layout

**File:** `app/layout.tsx`
**Action:** Import and render the NCodesWidget component inside the `<body>`, passing the current user. Adapt the user retrieval to your auth system.

```tsx
// Add this import at the top of the file:
import NCodesWidget from './components/NCodesWidget';

// Add this inside the <body> tag, after {children}:
<NCodesWidget user={{ id: 'demo', name: 'Demo User' }} />
```

**Note:** Replace the hardcoded user object with your actual auth logic (e.g., `getServerSession()`, `currentUser()`, or your auth provider's method). Pass `null` when the user is not logged in — the widget will automatically hide.

**Verify:** The root layout file imports and renders `NCodesWidget`.

## Verification

1. Start the dev server: `npm run dev`
2. Open the app in a browser
3. Confirm the "Build with AI" floating button appears at the bottom center
4. Click the button — the prompt panel should slide up
5. Enter a prompt like "Show overdue invoices" and click Generate
6. Confirm the generated UI appears
